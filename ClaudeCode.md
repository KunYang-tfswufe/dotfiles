# 《Claude Code：一本深入且通俗易懂的指南》——详细章节大纲（中文译本）

## 参考来源（官方与可信）

- Anthropic：Claude Code 最佳实践 — https://www.anthropic.com/engineering/claude-code-best-practices
- Anthropic：Anthropic 团队如何使用 Claude Code — https://www.anthropic.com/news/how-anthropic-teams-use-claude-code
- Anthropic：Claude 现已在 Xcode 中全面可用 — https://www.anthropic.com/news/claude-in-xcode
- Anthropic Academy（总览页，安装信息引用）：“通过 npm install -g @anthropic-ai/claude-code 快速开始使用 Claude Code。”

## 全书概览

- **读者定位**：软件工程师、数据科学家、DevOps、产品/设计工程师，以及希望采用智能体式编码（Agentic Coding）的技术从业者。
- **写作方法**：以实践与示例驱动，兼顾基础概念、安全与治理、真实工作流。
- **学习成果**：读者能够安装、配置并安全运行 Claude Code；设计高效工作流；集成工具；实现自动化；并在团队范围内推广与规模化落地。

---

## 第一部分——基础：入门与环境

### 第1章：什么是 Claude Code？智能体式编码的实战形态

- **你将学到**：
  - 智能体式编码与传统“聊天侧栏”的不同。
  - 为何 Claude Code“驻留在终端”，以及它如何自动拉取上下文。
  - 安全模型（权限提示、允许列表）与设计哲学。
- **关键主题**：
  - 自动上下文收集与令牌/时间开销的权衡。
  - 终端优先 vs. IDE 优先；分别适用的场景。
  - Claude Code 如何与测试、CI、代码评审互补。
- **动手实验**：
  - 选出你每周最常做的 3 个工作流，将其映射到智能体式编码模式。

### 第2章：安装与更新 Claude Code

- **你将学到**：
  - 通过 npm 安装（如 `npm install -g @anthropic-ai/claude-code`）、验证 CLI、更新流程。
  - 跨平台注意事项与前置依赖；官方文档查阅路径。
- **关键主题**：
  - CLI 基本用法、认证、首条命令。
  - 终端环境自检与常见问题。
- **动手实验**：
  - 安装、验证 CLI；运行帮助命令；完成认证。

### 第3章：首次运行与产品导览

- **你将学到**：
  - 初次会话：提示词、工具调用与权限交互。
  - 使用 `/init` 生成 `CLAUDE.md` 并建立团队约定。
- **关键主题**：
  - 权限模型与允许列表（Allowlist）。
  - 核心斜杠命令：`/init`、`/permissions`、`/clear`。
  - 配置文件：`.claude/settings.json`、`~/.claude.json`。
- **动手实验**：
  - 启动会话，运行 `/init`，观察 `CLAUDE.md` 如何被自动纳入上下文。

---

## 第二部分——核心工作流：快速创造价值

### 第4章：探索 → 规划 → 编码 → 提交

- **你将学到**：
  - 开发/改造任务的稳健闭环。
  - 使用“思考模式”（如 “think”、“think hard”、“ultrathink”）调整推理预算。
- **关键主题**：
  - 子智能体（subagents）用于并行验证与深挖细节。
  - 提交变更与高质量 PR 描述。
- **动手实验**：
  - 驱动一个小功能，完整走通“调研 → 规划 → 实现 → PR”的闭环。

### 第5章：用 Claude Code 实践 TDD

- **你将学到**：
  - 将测试优先开发与智能体式编码结合。
  - 防止“测试投机”与过拟合。
- **关键主题**：
  - 先写测试；确认失败；禁止修改测试用例。
  - 以失败为导向的迭代实现。
- **动手实验**：
  - 创建测试、提交测试、实现代码、反复运行直至通过。

### 第6章：调试与故障排除

- **你将学到**：
  - 结合 Claude Code 分析堆栈与日志。
  - 在陌生代码库中进行逐步诊断。
- **关键主题**：
  - 数据输入（如 `cat logs.txt | claude`）、使用清单/草稿板（scratchpad）。
  - 实时故障应对策略。
- **动手实验**：
  - 模拟一场生产事故，通过智能体循环解决。

### 第7章：可视化迭代：截图、设计稿与 UI 工作流

- **你将学到**：
  - 以截图与设计稿作为目标进行迭代。
- **关键主题**：
  - Puppeteer MCP、iOS 模拟器 MCP、手动图片输入。
  - 2–3 轮迭代收敛的经验法则。
- **动手实验**：
  - 依据给定设计稿复刻小型 UI，进行对比迭代直至匹配。

### 第8章：自信使用 Git 与 GitHub

- **你将学到**：
  - 日常 git 操作的智能体化。
  - 自动化 PR 与处理评审意见。
- **关键主题**：
  - 集成 `gh` CLI；仓库分诊；PR 速记（“pr”）。
  - 历史查询（设计缘由、所有权）；复杂 rebase 与冲突解决。
- **动手实验**：
  - 建分支、改代码、撰写优质 commit、发起 PR、修复评审意见。

### 第9章：Notebooks、数据与科研工作流

- **你将学到**：
  - 与 `.ipynb` 协作进行数据探索与展示。
- **关键主题**：
  - 读写 Notebook；为汇报美化图表。
- **动手实验**：
  - 清理并美化一个 Notebook，按“更美观”的明确指令优化可视化。

---

## 第三部分——定制化：教会 Claude 你的世界

### 第10章：打造高质量的 `CLAUDE.md`

- **你将学到**：
  - 写什么、放哪儿最合适。
- **关键主题**：
  - 仓库根目录、子目录、monorepo、`~/.claude/CLAUDE.md` 的取舍。
  - 使用 `#` 内联追加；提示词打磨；借助提示词改良器（Prompt Improver）。
- **动手实验**：
  - 编写精炼的 `CLAUDE.md`，覆盖命令、风格、测试约定。

### 第11章：权限与安全控制

- **你将学到**：
  - 精细控制工具访问与安全默认。
- **关键主题**：
  - `/permissions`、`--allowedTools`、`.claude/settings.json`、`~/.claude.json`。
  - 会话级 vs. 持久化权限；撤销与变更。
- **动手实验**：
  - 为团队制定一个最小权限的允许列表（Allowlist）。

### 第12章：用自定义斜杠命令固化流程

- **你将学到**：
  - 将提示词固化为 `.claude/commands/` 中可复用的命令。
- **关键主题**：
  - `$ARGUMENTS` 参数化。
  - 个人 vs. 团队命令；git 版本化与共享。
- **动手实验**：
  - 创建 `/project:fix-github-issue`，用于分诊并修复真实 issue。

### 第13章：通过 MCP 扩展生态

- **你将学到**：
  - 通过 Model Context Protocol 连接更广泛的工具。
- **关键主题**：
  - `.mcp.json`（项目内/全局）；`--mcp-debug` 调试。
  - 示例：Puppeteer 做截图、Sentry 处理问题单。
- **动手实验**：
  - 添加一个 MCP 服务器，并在调试或 UI 迭代中实际使用。

---

## 第四部分——自动化、CI 与规模化

### 第14章：无头模式（Headless）：无人值守地运行 Claude

- **你将学到**：
  - 在 CI、pre-commit、流水线等非交互场景中运行。
- **关键主题**：
  - 使用 `-p` 提交提示词；用 `--output-format stream-json` 输出结构化信息；`--verbose` 调试。
  - 参考模式：大规模迁移的扇出、数据处理流水线的串联。
- **动手实验**：
  - 构建一个无头脚本，对一组文件进行 lint 或重构，并输出 JSON 状态。

### 第15章：安全自治与容器化

- **你将学到**：
  - 何时以及如何使用 `claude --dangerously-skip-permissions`。
- **关键主题**：
  - 风险：提示注入、数据丢失/损坏、数据外泄。
  - 在无网络的最小权限容器中运行高风险批处理。
- **动手实验**：
  - 准备容器化环境，安全运行低风险的批量重构。

### 第16章：多 Claude 并行与 Git Worktrees

- **你将学到**：
  - 以多会话/多分支并行加速交付。
- **关键主题**：
  - `git worktree add …` 的模式；命名与窗口/标签管理。
  - 用 `/clear` 重置上下文做评审/测试；“写手/审稿人”双 Claude 分工。
- **动手实验**：
  - 建立 2–3 个 worktree；协调多个 Claude 并行完成一组特性。

---

## 第五部分——组织级落地

### 第17章：入职与代码库问答（Q&A）

- **你将学到**：
  - 以 Claude Code 作为新成员的加速器。
- **关键主题**：
  - 提问“日志系统如何工作？”“谁负责 X？”“Y 应该加在哪？”
  - 将分散知识沉淀为 Runbook 与 `CLAUDE.md`。
- **动手实验**：
  - 生成一个项目 Runbook 和入职 Q&A 提示词集。

### 第18章：文档与知识管理

- **你将学到**：
  - 把 wiki、注释与“部落知识”转化为可执行资产。
- **关键主题**：
  - 生成并校验“浓缩版” Runbook；保持文档时效。
- **动手实验**：
  - 将原始文档转化为精炼的故障排除指南，并在 `CLAUDE.md` 中挂链。

### 第19章：跨职能场景

- **你将学到**：
  - 非工程团队的实践：市场、法务、设计。
- **关键主题**：
  - 基于 CSV 的创意生成、Figma 插件、内部“电话树”原型。
- **动手实验**：
  - 构建一个 CSV→输出 的管道，并加入治理与评审闸门。

### 第20章：IDE 集成——Xcode 与更多

- **你将学到**：
  - 在 Xcode 中使用 Claude（Claude Sonnet 4 驱动的编码智能）。
- **关键主题**：
  - Xcode 26 设置；使用 Claude 账户登录；“编码工具”、编辑器内联改写。
  - 订阅用量在平台间共享（Pro/Max、Team/Enterprise 的高级席位）。
- **动手实验**：
  - 在 Xcode 中开启 Claude，自动生成文档、预览与 Swift 重构。

---

## 第六部分——安全、治理与最佳实践

### 第21章：内建安全：策略与护栏

- **你将学到**：
  - 为智能体式编码设计组织级指南。
- **关键主题**：
  - 允许列表策略；最小权限；密钥与凭证卫生。
  - 自动化变更的评审与审计。
- **动手实验**：
  - 起草团队政策与适用于智能体变更的 PR 模板。

### 第22章：优化提示、上下文与流程

- **你将学到**：
  - 通过清晰结构获得最佳结果。
- **关键主题**：
  - 具体化指令；明确文件路径；添加 URL 与图片；尽早纠偏。
  - 用 `/clear` 保持上下文卫生；用清单/草稿板处理大型任务。
- **动手实验**：
  - 将一个模糊任务重写为结构化计划，明确成功标准与检查点。

### 第23章：数据输入与结果输出：数据源、管道与格式

- **你将学到**：
  - 高效地输入数据与捕获结构化输出。
- **关键主题**：
  - 管道式输入：`cat foo.txt | claude`；JSON 流；CSV/Markdown 的结构化交接。
  - 结合 Bash 工具、MCP 与自定义命令。
- **动手实验**：
  - 构建一条流水线：日志 → 模式汇总 → 生成可执行的工单。

### 第24章：进阶模式与反模式

- **你将学到**：
  - 何时使用子智能体；何时重置上下文；避免脆弱提示词。
- **关键主题**：
  - 拆解策略；“写手/审稿人”双 Claude；迭代式验证。
  - 常见陷阱：范围蔓延、目标不清、缺少测试或视觉目标。
- **动手实验**：
  - 将一个凌乱的多步提示重构为健壮、可参数化的命令。

---

## 附录

- **附录A：快速入门与安装速查**
  - npm 安装、CLI 校验、认证、首跑指引。
- **附录B：CLI、标志位与配置文件参考**
  - 标志位：`-p`、`--output-format stream-json`、`--mcp-debug`、`--verbose`、`--allowedTools`。
  - 文件：`CLAUDE.md`、`CLAUDE.local.md`、`.claude/settings.json`、`~/.claude.json`、`.mcp.json`、`.claude/commands/*.md`。
- **附录C：安全清单**
  - 安全默认、容器化、网络出口控制、密钥管理、权限复核。
- **附录D：故障排除**
  - 常见问题、环境特性、MCP 连通性、权限不匹配。
- **附录E：延伸阅读与官方资源**
  - Anthropic 文档、工程博文与最佳实践链接。

---

## 实现要点（来自官方资料并已融入各章）

- **`CLAUDE.md` 自动纳入上下文**：可置于仓库根、子目录或 `~/.claude/CLAUDE.md`；`/init` 可生成；用 `#` 快速追加约定。
- **权限管理**：通过 `/permissions`、`--allowedTools`、`.claude/settings.json`、`~/.claude.json` 进行会话级与持久化控制。
- **MCP 扩展**：在 `.mcp.json` 配置项目内或全局服务器；用 `--mcp-debug` 调试。
- **无头模式**：使用 `-p` 提示与 `--output-format stream-json` 进行 CI/自动化；需要逐会话触发。
- **高风险批处理**：谨慎使用 `claude --dangerously-skip-permissions`；建议在无网络的最小权限容器中运行。
- **高产工作流**：TDD 循环、基于截图的 UI 迭代、代码库问答、git/GitHub 自动化、与 Jupyter 的协作。
- **Xcode 集成**：在 Xcode 26 中使用 Claude Sonnet 4 的编码智能，实现内联解释、文档生成与编辑。

---

## 需要我下一步做什么？

- **定制读者画像**：要不要面向某一类读者（如 Python 后端、全栈 JS、数据科学）做针对性强化？
- **扩写样章**：是否希望我将某一章扩展为完整样章（含图示与终端会话记录）？
- **配套示例仓库**：是否需要我创建配套示例仓库（含 `CLAUDE.md`、`.mcp.json`、`.claude/commands/`）以支持练习？
